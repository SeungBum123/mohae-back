upstream backend {
  server nest:8080; # docker-compose에서 사용할 service name
  keepalive 32;
}

server {
  listen 80;
  server_name mo-hae.site;
  server_tokens off;

  location / {
    return 301 https://$host$request_uri;
  }

  location /.well-known/acme-challenge/ {
    root /var/www/certbot;
  }

  # location / {
  #   proxy_pass http://backend;
  #   proxy_http_version 1.1;
  #   proxy_set_header Connection "";
  # }
}

# upstream loadbalencer{
#         least_conn;
#         server nest:8080;
#         server nest:4000;
#         server nest:5000;
# }
# 443 포트로 접근시 ssl을 적용한 뒤 로드벨런서로 요청을 전달해주도록 하는 설정
# server {
#         location / {
#                 proxy_pass http://loadbalencer;
#         }
#         listen 443 ssl; # managed by Certbot

#         ssl_certificate /etc/letsencrypt/live/mo-hae.site/fullchain.pem;
#         ssl_certificate_key /etc/letsencrypt/live/mo-hae.site/privkey.pem;
#         include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
#         ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
# }

# 80 포트로 접근시 443 포르로 리다이렉트 시켜주는 설정
# server {
#         listen 80;
#         if ($host = mo-hae.site) {
#                 return 301 https://$host$request_uri;
#         } # managed by Certbot
#         server_name mo-hae.site;
#         return 404; # managed by Certbot
# }
